<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>admin</title>
</head>
<body>

  <div id="login">
    <input id="password" type="password" placeholder="password" />
    <button id="loginBtn">login</button>
    <p id="error" style="color:red;"></p>
  </div>

  <div id="admin" style="display:none;">
    <h1>admin page</h1>
  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

    const supabase = createClient(
      'SUPABASE_URL',
      'SUPABASE_ANON_KEY'
    )

    const ADMIN_EMAIL = 'tensorggacc@gmail.com'

    async function init() {
      const { data: { session } } = await supabase.auth.getSession()

      if (!session) {
        // 로그인 안 된 상태
        document.getElementById('login').style.display = 'block'
        document.getElementById('admin').style.display = 'none'
      } else {
        // 로그인 된 상태
        document.getElementById('login').style.display = 'none'
        document.getElementById('admin').style.display = 'block'
      }
    }

    document.getElementById('loginBtn').onclick = async () => {
      const password = document.getElementById('password').value

      const { error } = await supabase.auth.signInWithPassword({
        email: ADMIN_EMAIL,
        password
      })

      if (error) {
        document.getElementById('error').innerText = '로그인 실패'
        return
      }

      init()
    }

    init()
  </script>

</body>
</html>
